<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Product Filter</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Smooth fade transition for grid updates */
        #product-grid {
            transition: opacity 0.3s ease-in-out;
        }
        .fade-out {
            opacity: 0.5;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans">

    <!-- Header Section -->
    <header class="bg-white shadow-sm sticky top-0 z-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                
                <!-- Logo / Title -->
                <div class="flex items-center gap-2">
                    <div class="bg-indigo-600 p-2 rounded-lg text-white">
                        <i data-lucide="shopping-cart" class="w-6 h-6"></i>
                    </div>
                    <h1 class="text-2xl font-bold tracking-tight text-gray-900">Market<span class="text-indigo-600">Find</span></h1>
                </div>

                <!-- Search Bar -->
                <div class="relative w-full md:w-96">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <i data-lucide="search" class="h-5 w-5 text-gray-400"></i>
                    </div>
                    <input
                        type="text"
                        id="search-input"
                        placeholder="Search products..."
                        class="block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg leading-5 bg-gray-50 placeholder-gray-500 focus:outline-none focus:bg-white focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm transition-colors"
                    />
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <!-- Controls Section -->
        <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center mb-8 gap-4 bg-white p-4 rounded-xl shadow-sm border border-gray-100">
            
            <!-- Category Filter Buttons -->
            <div class="flex flex-wrap items-center gap-2" id="category-container">
                <span class="text-sm font-medium text-gray-500 flex items-center gap-1 mr-2">
                    <i data-lucide="filter" class="w-4 h-4"></i> Category:
                </span>
                <!-- Buttons will be injected here -->
            </div>

            <!-- Sort Dropdown -->
            <div class="flex items-center gap-3 w-full lg:w-auto">
                <label for="sort-select" class="text-sm font-medium text-gray-500 flex items-center gap-1 whitespace-nowrap">
                    <i data-lucide="arrow-up-down" class="w-4 h-4"></i> Sort By:
                </label>
                <select
                    id="sort-select"
                    class="block w-full lg:w-48 pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-lg bg-gray-50 cursor-pointer hover:bg-white transition-colors border"
                >
                    <option value="default">Featured</option>
                    <option value="price-asc">Price: Low to High</option>
                    <option value="price-desc">Price: High to Low</option>
                    <option value="rating">Highest Rated</option>
                    <option value="name">Name (A-Z)</option>
                </select>
            </div>
        </div>

        <!-- Results Info -->
        <div class="mb-4 flex justify-between items-center text-sm text-gray-500">
            <p>Showing <span id="result-count" class="font-semibold text-gray-900">0</span> results</p>
        </div>

        <!-- Product Grid -->
        <div id="product-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 opacity-100">
            <!-- Product Cards will be injected here -->
        </div>

        <!-- No Results State (Hidden by default) -->
        <div id="no-results" class="hidden text-center py-20 bg-white rounded-xl border border-dashed border-gray-300">
            <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-gray-100 mb-4">
                <i data-lucide="search" class="h-8 w-8 text-gray-400"></i>
            </div>
            <h3 class="text-lg font-medium text-gray-900">No products found</h3>
            <p class="text-gray-500 mt-1">Try adjusting your search or filters.</p>
            <button 
                id="clear-filters-btn"
                class="mt-4 text-indigo-600 font-medium hover:text-indigo-500"
            >
                Clear all filters
            </button>
        </div>

    </main>

    <script>
        // --- Mock Data ---
        const PRODUCTS = [
            {
                id: 1,
                name: "Premium Wireless Headphones",
                category: "Electronics",
                price: 299.99,
                rating: 4.8,
                image: "https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=500&q=80",
                description: "Immersive sound with active noise cancellation."
            },
            {
                id: 2,
                name: "Minimalist Watch",
                category: "Accessories",
                price: 149.50,
                rating: 4.5,
                image: "https://images.unsplash.com/photo-1523275335684-37898b6baf30?w=500&q=80",
                description: "Elegant design suitable for any occasion."
            },
            {
                id: 3,
                name: "Ergonomic Office Chair",
                category: "Furniture",
                price: 450.00,
                rating: 4.9,
                image: "https://images.unsplash.com/photo-1592078615290-033ee584e267?w=500&q=80",
                description: "Designed for all-day comfort and support."
            },
            {
                id: 4,
                name: "Smart Fitness Tracker",
                category: "Electronics",
                price: 89.99,
                rating: 4.3,
                image: "https://images.unsplash.com/photo-1575311373937-040b8e1fd5b6?w=500&q=80",
                description: "Track your health metrics in real-time."
            },
            {
                id: 5,
                name: "Leather Messenger Bag",
                category: "Accessories",
                price: 199.00,
                rating: 4.7,
                image: "https://images.unsplash.com/photo-1553062407-98eeb64c6a62?w=500&q=80",
                description: "Handcrafted genuine leather with ample storage."
            },
            {
                id: 6,
                name: "Ceramic Coffee Set",
                category: "Home",
                price: 45.00,
                rating: 4.6,
                image: "https://images.unsplash.com/photo-1517256064527-09c73fc73e38?w=500&q=80",
                description: "Beautiful handcrafted ceramic set for 4."
            },
            {
                id: 7,
                name: "Modern Desk Lamp",
                category: "Furniture",
                price: 79.99,
                rating: 4.4,
                image: "https://images.unsplash.com/photo-1507473888900-52e1adad5481?w=500&q=80",
                description: "Adjustable LED lighting with touch control."
            },
            {
                id: 8,
                name: "Running Shoes",
                category: "Footwear",
                price: 120.00,
                rating: 4.5,
                image: "https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=500&q=80",
                description: "Lightweight and breathable for daily runs."
            },
        ];

        const CATEGORIES = ["All", ...new Set(PRODUCTS.map(p => p.category))];

        // --- State ---
        let state = {
            category: "All",
            sort: "default",
            search: ""
        };

        // --- DOM Elements ---
        const productGrid = document.getElementById('product-grid');
        const categoryContainer = document.getElementById('category-container');
        const sortSelect = document.getElementById('sort-select');
        const searchInput = document.getElementById('search-input');
        const resultCount = document.getElementById('result-count');
        const noResults = document.getElementById('no-results');
        const clearFiltersBtn = document.getElementById('clear-filters-btn');

        // --- Initialization ---
        function init() {
            renderCategories();
            updateDisplay();
            
            // Initial Icon render for static elements
            lucide.createIcons();

            // Event Listeners
            searchInput.addEventListener('input', (e) => {
                state.search = e.target.value;
                scheduleUpdate();
            });

            sortSelect.addEventListener('change', (e) => {
                state.sort = e.target.value;
                scheduleUpdate();
            });

            clearFiltersBtn.addEventListener('click', () => {
                state.category = "All";
                state.search = "";
                state.sort = "default";
                
                // Update UI inputs
                searchInput.value = "";
                sortSelect.value = "default";
                renderCategories(); // To update active button state
                scheduleUpdate();
            });
        }

        // --- Logic & Rendering ---

        function renderCategories() {
            // Remove existing buttons (keep the label)
            const label = categoryContainer.querySelector('span');
            categoryContainer.innerHTML = '';
            categoryContainer.appendChild(label);

            CATEGORIES.forEach(cat => {
                const btn = document.createElement('button');
                const isActive = state.category === cat;
                
                btn.textContent = cat;
                btn.className = `px-4 py-1.5 rounded-full text-sm font-medium transition-all duration-200 ${
                    isActive
                        ? "bg-indigo-600 text-white shadow-md transform scale-105"
                        : "bg-gray-100 text-gray-600 hover:bg-gray-200 hover:text-gray-900"
                }`;
                
                btn.onclick = () => {
                    state.category = cat;
                    renderCategories(); // Re-render to update active classes
                    scheduleUpdate();
                };
                
                categoryContainer.appendChild(btn);
            });
        }

        function getFilteredProducts() {
            let result = [...PRODUCTS];

            // 1. Filter by Category
            if (state.category !== "All") {
                result = result.filter(p => p.category === state.category);
            }

            // 2. Filter by Search
            if (state.search.trim() !== "") {
                const query = state.search.toLowerCase();
                result = result.filter(p => 
                    p.name.toLowerCase().includes(query) || 
                    p.description.toLowerCase().includes(query)
                );
            }

            // 3. Sort
            switch (state.sort) {
                case "price-asc":
                    result.sort((a, b) => a.price - b.price);
                    break;
                case "price-desc":
                    result.sort((a, b) => b.price - a.price);
                    break;
                case "rating":
                    result.sort((a, b) => b.rating - a.rating);
                    break;
                case "name":
                    result.sort((a, b) => a.name.localeCompare(b.name));
                    break;
            }
            return result;
        }

        function generateStarRating(rating) {
            let starsHtml = '';
            for (let i = 0; i < 5; i++) {
                const fillClass = i < Math.floor(rating) ? "text-yellow-400 fill-current" : "text-gray-300";
                // Using SVG string directly for stars in loop to avoid complex DOM manipulation with Lucide re-scan
                starsHtml += `
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="${i < Math.floor(rating) ? 'currentColor' : 'none'}" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-star ${i < Math.floor(rating) ? 'text-yellow-400' : 'text-gray-300'}">
                        <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                    </svg>
                `;
            }
            return starsHtml;
        }

        function renderProducts(products) {
            productGrid.innerHTML = '';

            if (products.length === 0) {
                productGrid.classList.add('hidden');
                noResults.classList.remove('hidden');
                // Re-render icons for the no-results section just in case
                lucide.createIcons({ root: noResults });
            } else {
                productGrid.classList.remove('hidden');
                noResults.classList.add('hidden');

                products.forEach(product => {
                    const card = document.createElement('div');
                    card.className = "group bg-white rounded-xl shadow-sm hover:shadow-xl border border-gray-100 overflow-hidden transition-all duration-300 hover:-translate-y-1 flex flex-col h-full";
                    
                    card.innerHTML = `
                        <div class="relative h-64 overflow-hidden bg-gray-200">
                            <img 
                                src="${product.image}" 
                                alt="${product.name}" 
                                class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
                            />
                            <div class="absolute top-3 right-3 opacity-0 group-hover:opacity-100 transition-opacity duration-200">
                                <button class="p-2 bg-white rounded-full shadow-md text-gray-400 hover:text-red-500 transition-colors">
                                    <i data-lucide="heart" class="w-4 h-4"></i>
                                </button>
                            </div>
                            <div class="absolute top-3 left-3">
                                <span class="bg-white/90 backdrop-blur-sm px-2 py-1 rounded text-xs font-semibold text-gray-700 shadow-sm">
                                    ${product.category}
                                </span>
                            </div>
                        </div>

                        <div class="p-5 flex-1 flex flex-col">
                            <div class="flex justify-between items-start mb-2">
                                <h3 class="text-lg font-bold text-gray-900 leading-tight group-hover:text-indigo-600 transition-colors line-clamp-1">
                                    ${product.name}
                                </h3>
                            </div>
                            
                            <p class="text-gray-500 text-sm mb-4 line-clamp-2 flex-1">
                                ${product.description}
                            </p>

                            <div class="flex items-center mb-4">
                                <div class="flex text-yellow-400 gap-0.5">
                                    ${generateStarRating(product.rating)}
                                </div>
                                <span class="text-xs text-gray-400 ml-2">(${product.rating})</span>
                            </div>

                            <div class="flex items-center justify-between pt-4 border-t border-gray-50">
                                <span class="text-xl font-bold text-gray-900">
                                    $${product.price.toFixed(2)}
                                </span>
                                <button class="bg-indigo-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-indigo-700 active:bg-indigo-800 transition-colors flex items-center gap-2">
                                    Add <i data-lucide="shopping-cart" class="w-4 h-4"></i>
                                </button>
                            </div>
                        </div>
                    `;
                    productGrid.appendChild(card);
                });
                
                // Initialize icons for new elements
                lucide.createIcons({ root: productGrid });
            }
        }

        // --- Animation Handling ---
        let updateTimeout;

        function scheduleUpdate() {
            // Start fade out
            productGrid.classList.add('fade-out');
            
            // Clear existing timeout if user is typing fast
            if (updateTimeout) clearTimeout(updateTimeout);

            updateTimeout = setTimeout(() => {
                updateDisplay();
                // Fade back in
                productGrid.classList.remove('fade-out');
            }, 300);
        }

        function updateDisplay() {
            const filtered = getFilteredProducts();
            resultCount.textContent = filtered.length;
            renderProducts(filtered);
        }

        // Start App
        init();

    </script>
</body>
</html>